<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(
                    title='나의 역량 현황',
                    content=~{::main},
                    css=~{::#page-css},
                    scripts=~{::#page-scripts}
                  )}">

<th:block th:fragment="css" id="page-css">
    <link rel="stylesheet" href="https://uicdn.toast.com/chart/latest/toastui-chart.min.css" />
    <link th:href="@{/css/competency/assessment-history.css}" rel="stylesheet">
</th:block>

<main th:fragment="content" class="container-lg my-5">
    <div class="assessment-history-container">
        <div class="page-header d-flex justify-content-between align-items-center mb-4">
            <h2 class="page-title">나의 역량 현황</h2>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-0">
                    <li class="breadcrumb-item"><a href="/"><i class="fas fa-home"></i></a></li>
                    <li class="breadcrumb-item">역량진단</li>
                    <li class="breadcrumb-item active" aria-current="page">나의 역량 현황</li>
                </ol>
            </nav>
        </div>

        <div class="history-card card shadow-sm mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0"><i class="fas fa-chart-line me-2"></i>역량 점수 추이</h5>

                <div class="btn-group" role="group" aria-label="Chart type toggle">
                    <button type="button" class="btn btn-sm btn-outline-primary active" id="btnShowLineChart">
                        <i class="fas fa-chart-line"></i> 꺾은선
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-primary" id="btnShowBarChart">
                        <i class="fas fa-chart-bar"></i> 막대
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="chart-container-wrapper">
                    <div id="historyChart"></div>
                </div>
            </div>
        </div>

        <div class="history-card card shadow-sm">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="fas fa-table me-2"></i>나의 핵심 역량 점수</h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table history-table mb-0">
                        <thead>
                        <tr>
                            <th scope="col">진단명(년도)</th>
                            <th scope="col" th:each="label : ${competencyLabels}" th:text="${label}">
                                창의성
                            </th>
                            <th scope="col" class="text-center">자세히 보기</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:if="${#lists.isEmpty(historyData)}">
                            <td th:colspan="${#lists.size(competencyLabels) + 2}" class="text-center py-4">
                                진단 이력이 없습니다.
                            </td>
                        </tr>
                        <tr th:each="row : ${historyData}">
                            <td th:text="${row.diagnosisTitle}">2025년 1학기 진단</td>

                            <td th:each="score : ${row.scores}"
                                th:text="${#numbers.formatDecimal(score, 1, 1)}">
                                4.6
                            </td>

                            <td class="text-center">
                                <a th:href="@{/assessment/result/{id}(id=${row.resultId})}"
                                   class="btn btn-outline-secondary btn-sm">
                                    자세히 보기
                                </a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
</main>

<th:block th:fragment="scripts" id="page-scripts">
    <script src="https://uicdn.toast.com/chart/latest/toastui-chart.min.js"></script>
    <script th:src="@{/js/competency/assessment-history.js}"></script>

    <script th:inline="javascript">
        /*<![CDATA[*/

        // (A) 컨트롤러에서 받은 데이터를 JS 변수로 변환
        // (뷰-우선 작업을 위해 예시 더미 데이터를 넣어둠)
        const competencyLabels = /*[[${competencyLabels}]]*/ ["창의성", "통합적 사고", "실무활용", "협업"];
        const historyData = /*[[${historyData}]]*/ [
            { diagnosisTitle: "2025년", scores: [4.6, 3.5, 3.8, 2.2] },
            { diagnosisTitle: "2024년", scores: [4.0, 3.8, 3.5, 3.0] }
        ];

        /*]]>*/
    </script>
</th:block>
</html>