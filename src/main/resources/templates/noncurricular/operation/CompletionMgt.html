<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>OP-006 이수현황 관리</title>
    <style>
        :root {
            --bg:#f8fafc; --panel:#ffffff; --soft:#f2f4f8;
            --text:#1e293b; --muted:#64748b;
            --border:#d0d5dd; --brand:#2563eb;
            --ok:#16a34a; --warn:#f59e0b; --danger:#dc2626; --chip:#e2e8f0;
            --radius:14px; --shadow:0 2px 12px rgba(0,0,0,.08);
        }
        *{box-sizing:border-box}
        body{margin:0;background:var(--bg);color:var(--text);
            font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,Noto Sans KR,Arial;}
        a{color:inherit;text-decoration:none}
        .wrap{max-width:1200px;margin:32px auto;padding:0 16px}

        /* Header */
        .pagehead{display:flex;align-items:flex-end;gap:16px;flex-wrap:wrap;margin-bottom:16px}
        .pagehead h1{font-size:22px;margin:0}
        .pill{background:var(--chip);border:1px solid var(--border);
            padding:4px 10px;border-radius:999px;color:var(--muted)}

        /* Search panel */
        .search{background:var(--panel);border:1px solid var(--border);
            border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
        .search-grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
        .f{display:flex;flex-direction:column;gap:6px}
        .f label{font-size:12px;color:var(--muted)}
        .f input,.f select{
            background:var(--soft);border:1px solid var(--border);
            border-radius:10px;color:var(--text);padding:10px 12px
        }
        .row-actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
        .btn{
            border:1px solid var(--border);background:var(--panel);
            color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer;
            transition:background .15s,border-color .15s
        }
        .btn:hover{background:#e9eef7}
        .btn.primary{background:var(--brand);border-color:#1d4ed8;color:#fff}
        .btn.ghost{background:var(--soft);border-color:var(--border)}
        .btn.warn{background:var(--warn);border-color:#d97706;color:#fff}
        .btn.ok{background:var(--ok);border-color:#15803d;color:#fff}
        .btn.danger{background:var(--danger);border-color:#b91c1c;color:#fff}

        /* Table */
        .card{background:var(--panel);border:1px solid var(--border);
            border-radius:var(--radius);box-shadow:var(--shadow);margin-top:16px}
        .toolbar{display:flex;justify-content:space-between;align-items:center;
            padding:12px 16px;border-bottom:1px solid var(--border)}
        .toolbar .hint{color:var(--muted);font-size:12px}
        .table-wrap{overflow:auto}
        table{width:100%;border-collapse:separate;border-spacing:0}
        thead th{
            position:sticky;top:0;background:#f9fafb;border-bottom:1px solid var(--border);
            color:var(--muted);text-align:left;font-weight:600;padding:12px
        }
        tbody td{border-bottom:1px solid var(--border);padding:12px;vertical-align:middle}
        tbody tr:hover{background:#f2f4f8}
        .num{color:var(--muted)}
        .badge{
            display:inline-flex;align-items:center;gap:6px;padding:4px 8px;
            border-radius:999px;border:1px solid var(--border);background:var(--soft);
            color:var(--text);font-size:12px
        }
        .badge.gray{background:#f1f5f9;color:#475569}
        .badge.ok{background:#dcfce7;border-color:#86efac;color:#166534}
        .badge.warn{background:#fef9c3;border-color:#fde047;color:#92400e}
        .badge.danger{background:#fee2e2;border-color:#fca5a5;color:#991b1b}
        .link{color:var(--brand);text-decoration:none}
        .link:hover{text-decoration:underline}
        .row-actions-inline{display:flex;gap:8px;flex-wrap:wrap}

        /* Bulk bar */
        .bulkbar{position:sticky;bottom:12px;display:none;gap:8px;
            justify-content:flex-end;align-items:center;background:#ffffffcc;
            border:1px solid var(--border);backdrop-filter:blur(8px);
            padding:10px;border-radius:12px;box-shadow:var(--shadow);margin-top:12px}

        /* Pagination */
        .pagination{display:flex;justify-content:center;gap:6px;padding:12px}
        .pagebtn{
            min-width:36px;height:36px;border-radius:10px;border:1px solid var(--border);
            background:#fff;color:var(--text);cursor:pointer
        }
        .pagebtn[aria-current="page"]{background:var(--brand);border-color:var(--brand);color:#fff}

        /* Modal */
        dialog{border:none;border-radius:16px;background:#fff;color:var(--text);
            max-width:720px;width:96%;padding:0;box-shadow:var(--shadow)}
        dialog::backdrop{background:rgba(0,0,0,.45)}
        .modal-head{display:flex;justify-content:space-between;align-items:center;
            padding:14px 16px;border-bottom:1px solid var(--border)}
        .modal-body{padding:16px;display:grid;gap:12px}
        .kv{display:grid;grid-template-columns:140px 1fr;gap:8px;align-items:center}
        .muted{color:var(--muted)}
        .modal-actions{display:flex;gap:8px;justify-content:flex-end;
            padding:12px 16px;border-top:1px solid var(--border)}

        /* Toast */
        .toast{position:fixed;right:16px;bottom:16px;display:flex;flex-direction:column;
            gap:8px;z-index:9999}
        .toast .t{
            background:#fff;border:1px solid var(--border);color:var(--text);
            padding:12px 14px;border-radius:12px;box-shadow:var(--shadow);opacity:.98
        }
        .t.ok{border-color:var(--ok)}
        .t.err{border-color:var(--danger)}
        .t.warn{border-color:var(--warn)}

        /* Responsive tweaks */
        @media (max-width:860px){
            .search-grid{grid-template-columns:repeat(6,1fr)}
        }
        @media (max-width:580px){
            .search-grid{grid-template-columns:repeat(2,1fr)}
            thead th:nth-child(4), tbody td:nth-child(4){display:none}
            thead th:nth-child(7), tbody td:nth-child(7){display:none}
            .kv{grid-template-columns:1fr}
        }
    </style>
</head>
<body>
<div class="wrap">
    <div class="pagehead">
        <h1>OP-006 이수현황 관리</h1>
        <span class="pill">운영자 / 부서관리자 권한</span>
    </div>

    <!-- 검색/필터 -->
    <section class="search" aria-label="검색 및 필터">
        <div class="search-grid">
            <div class="f" style="grid-column:span 4;">
                <label for="program">프로그램</label>
                <select id="program"></select>
            </div>
            <div class="f" style="grid-column:span 3;">
                <label for="schedule">회차</label>
                <select id="schedule" disabled></select>
            </div>
            <div class="f" style="grid-column:span 2;">
                <label for="studentNo">학번</label>
                <input id="studentNo" placeholder="예: 20251234" />
            </div>
            <div class="f" style="grid-column:span 3;">
                <label for="name">이름</label>
                <input id="name" placeholder="학생명" />
            </div>
            <div class="f" style="grid-column:span 3;">
                <label for="dept">학과</label>
                <input id="dept" placeholder="학과명" />
            </div>
            <div class="f" style="grid-column:span 2;">
                <label for="grade">학년</label>
                <select id="grade">
                    <option value="">전체</option>
                    <option value="1">1학년</option>
                    <option value="2">2학년</option>
                    <option value="3">3학년</option>
                    <option value="4">4학년</option>
                </select>
            </div>
            <div class="f" style="grid-column:span 2;">
                <label for="status">이수상태</label>
                <select id="status">
                    <option value="">전체</option>
                    <option value="COMPLETE">이수</option>
                    <option value="INCOMPLETE">미이수</option>
                </select>
            </div>
            <div class="f" style="grid-column:span 2;">
                <label for="attOk">출석충족</label>
                <select id="attOk">
                    <option value="">전체</option>
                    <option value="Y">예</option>
                    <option value="N">아니오</option>
                </select>
            </div>
            <div class="f" style="grid-column:span 2;">
                <label for="satOk">만족도제출</label>
                <select id="satOk">
                    <option value="">전체</option>
                    <option value="Y">예</option>
                    <option value="N">아니오</option>
                </select>
            </div>
            <div class="f" style="grid-column:span 2;">
                <label for="mileOk">마일리지반영</label>
                <select id="mileOk">
                    <option value="">전체</option>
                    <option value="Y">예</option>
                    <option value="N">아니오</option>
                </select>
            </div>
        </div>
        <div class="row-actions">
            <button class="btn primary" id="btnSearch">검색</button>
            <button class="btn ghost" id="btnReset">초기화</button>
            <button class="btn" id="btnExport">엑셀다운로드</button>
        </div>
    </section>

    <!-- 결과 테이블 -->
    <section class="card" aria-label="이수 현황 목록">
        <div class="toolbar">
            <div class="hint" id="resultHint">검색 후 결과가 표시됩니다.</div>
            <div class="row-actions">
                <button class="btn ok" id="btnBulkComplete" disabled>선택 이수처리</button>
                <button class="btn warn" id="btnBulkRevoke" disabled>선택 이수취소</button>
                <button class="btn ok" id="btnBulkMileageApply" disabled>선택 마일리지반영</button>
                <button class="btn danger" id="btnBulkMileageCancel" disabled>선택 마일리지취소</button>
            </div>
        </div>
        <div class="table-wrap">
            <table id="tbl">
                <thead>
                <tr>
                    <th style="width:34px;"><input type="checkbox" id="chkAll" aria-label="전체선택"></th>
                    <th style="width:60px;">No</th>
                    <th style="min-width:140px;">학번/이름</th>
                    <th style="min-width:160px;">학과/학년</th>
                    <th style="min-width:120px;">신청유형</th>
                    <th style="min-width:140px;">출석(누적/필요)</th>
                    <th style="min-width:120px;">만족도</th>
                    <th style="min-width:90px;">이수여부</th>
                    <th style="min-width:120px;">마일리지</th>
                    <th style="min-width:150px;">이수일시</th>
                    <th style="min-width:260px;">조작</th>
                </tr>
                </thead>
                <tbody id="tbody">
                <!-- rows injected -->
                </tbody>
            </table>
        </div>
        <div class="pagination" id="pagination" role="navigation" aria-label="페이지네이션"></div>
    </section>

    <!-- 선택 일괄 바 (모바일 보조) -->
    <div class="bulkbar" id="bulkbar">
        <button class="btn ok" id="mBulkComplete">선택 이수</button>
        <button class="btn warn" id="mBulkRevoke">선택 취소</button>
        <button class="btn ok" id="mBulkMileageApply">선택 마일리지</button>
        <button class="btn danger" id="mBulkMileageCancel">선택 마일리지 취소</button>
    </div>
</div>

<!-- 상세 모달 -->
<dialog id="dlg">
    <div class="modal-head">
        <strong>이수 상세</strong>
        <button class="btn ghost" onclick="dlg.close()">닫기</button>
    </div>
    <div class="modal-body" id="dlgBody">
        <!-- injected -->
    </div>
    <div class="modal-actions">
        <button class="btn ok" id="dlgComplete">이수처리</button>
        <button class="btn warn" id="dlgRevoke">이수취소</button>
        <button class="btn ok" id="dlgMileageApply">마일리지반영</button>
        <button class="btn danger" id="dlgMileageCancel">마일리지취소</button>
        <a class="btn" id="dlgCert" href="#" target="_blank" rel="noopener">이수증 보기</a>
    </div>
</dialog>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
    /* ================================
       0) 서버 연동 포인트 (URL/메서드)
       ================================ */
    const ENDPOINTS = {
        list: (q)=> `/op/completions?${q}`,                         // GET
        export: (q)=> `/op/completions/export?${q}`,                // GET (file)
        detail: (id)=> `/op/completions/${id}`,                     // GET
        complete: (id)=> `/op/completions/${id}/complete`,          // POST
        revoke: (id)=> `/op/completions/${id}/revoke`,              // POST
        mileApply: (id)=> `/op/completions/${id}/mileage/apply`,    // POST
        mileCancel: (id)=> `/op/completions/${id}/mileage/cancel`,  // POST
        bulkComplete: `/op/completions/bulk/complete`,              // POST
        bulkRevoke: `/op/completions/bulk/revoke`,                  // POST
        bulkMileApply: `/op/completions/bulk/mileage/apply`,        // POST
        bulkMileCancel: `/op/completions/bulk/mileage/cancel`,      // POST
        programs: `/api/programs/approved`,                         // GET
        schedules: (programId)=> `/api/programs/${programId}/schedules` // GET
    };

    // 데모를 위해 목업 데이터 사용 (실서는 fetch()로 교체)
    const MOCK = {
        programs: [
            {id:101, title:"진로역량 Booster"},
            {id:102, title:"리더십 캠프"},
        ],
        schedules: {
            101: [{id:1001, name:"1회차(11/21 10:00)"},{id:1002, name:"2회차(11/28 10:00)"}],
            102: [{id:2001, name:"1회차(12/02 14:00)"}]
        },
        rows: Array.from({length:27}).map((_,i)=>({
            applicationId: 7000+i,
            no:i+1,
            studentNo:`2025${String(1000+i).slice(-4)}`,
            name: ["김하늘","이도윤","박서준","최지우","정가을"][i%5],
            dept: ["컴퓨터공학","산업경영","전자","화학","디자인"][i%5],
            grade: (i%4)+1,
            appType: ["GENERAL","WAITLIST","PRIORITY"][i%3],
            attend:{acc: (i%5)+1, need:5, ok:(i%2===0)},
            satisfaction: {submitted: i%3!==0, rating: (i%5)+1},
            status: (i%4===0)?"COMPLETE":"INCOMPLETE",
            mileage: (i%4===0)?{applied:true, points:10}:{applied:false, points:0},
            completedAt: (i%4===0)?"2025-11-05 15:20":"-"
        }))
    };

    /* ================================
       1) 상태
       ================================ */
    const state = {
        page: 1,
        size: 10,
        total: 0,
        rows: [],
        selected: new Set(),
        currentDetailId: null
    };

    /* ================================
       2) 유틸/토스트
       ================================ */
    const $ = (sel)=> document.querySelector(sel);
    const el = (tag, cls)=> Object.assign(document.createElement(tag), cls?{className:cls}:{});
    function qs(obj){return new URLSearchParams(obj).toString();}
    function toast(msg, type="ok"){
        const box = $("#toast"); const t = el("div","t "+type); t.textContent = msg;
        box.appendChild(t); setTimeout(()=>{ t.style.opacity="0"; setTimeout(()=>t.remove(),200)}, 2000);
    }
    function fmtAppType(t){
        return {GENERAL:"일반",WAITLIST:"대기",PRIORITY:"우선"}[t] ?? t;
    }

    /* ================================
       3) 초기화(프로그램/회차)
       ================================ */
    async function loadPrograms(){
        // const res = await fetch(ENDPOINTS.programs); const list = await res.json();
        const list = MOCK.programs;
        const sel = $("#program"); sel.innerHTML = `<option value="">선택하세요</option>` +
        list.map(p=> `<option value="${p.id}">${p.title}</option>`).join("");
    }
    async function loadSchedules(programId){
        const sel = $("#schedule");
        sel.disabled = !programId;
        if(!programId){ sel.innerHTML = ""; return; }
        // const res = await fetch(ENDPOINTS.schedules(programId)); const list = await res.json();
        const list = MOCK.schedules[programId] ?? [];
        sel.innerHTML = `<option value="">전체</option>` + list.map(s=> `<option value="${s.id}">${s.name}</option>`).join("");
    }

    /* ================================
       4) 조회/렌더/페이징
       ================================ */
    function getFilters(){
        return {
            programId: $("#program").value || "",
            scheduleId: $("#schedule").value || "",
            studentNo: $("#studentNo").value.trim(),
            name: $("#name").value.trim(),
            dept: $("#dept").value.trim(),
            grade: $("#grade").value,
            status: $("#status").value,
            attOk: $("#attOk").value,
            satOk: $("#satOk").value,
            mileageOk: $("#mileOk").value,
            page: state.page,
            size: state.size
        };
    }

    async function search(){
        state.selected.clear();
        $("#chkAll").checked = false;

        const q = qs(getFilters());
        // 실제: const res = await fetch(ENDPOINTS.list(q)); const {content,totalElements} = await res.json();
        // 데모 페이지네이션
        const start = (state.page-1)*state.size;
        const end = start + state.size;
        state.total = MOCK.rows.length;
        state.rows = MOCK.rows.slice(start,end);

        renderTable(); renderPagination();
        $("#resultHint").textContent = `총 ${state.total}건 중 ${start+1}–${Math.min(end,state.total)} 표시`;
    }

    function renderTable(){
        const TB = $("#tbody"); TB.innerHTML = "";
        state.rows.forEach((r,idx)=>{
            const tr = el("tr");
            const checked = state.selected.has(r.applicationId);
            tr.innerHTML = `
      <td><input type="checkbox" data-id="${r.applicationId}" ${checked?"checked":""}></td>
      <td class="num">${r.no}</td>
      <td><a class="link" href="javascript:;" data-detail="${r.applicationId}">${r.studentNo} / ${r.name}</a></td>
      <td>${r.dept} / ${r.grade}학년</td>
      <td><span class="badge gray">${fmtAppType(r.appType)}</span></td>
      <td>
        ${r.attend.acc}/${r.attend.need}
        ${r.attend.ok?'<span class="badge ok" style="margin-left:6px">충족</span>':'<span class="badge warn" style="margin-left:6px">미충족</span>'}
      </td>
      <td>
        ${r.satisfaction.submitted?`제출(${r.satisfaction.rating}★)`:'미제출'}
      </td>
      <td>${r.status==="COMPLETE"?'<span class="badge ok">이수</span>':'<span class="badge danger">미이수</span>'}</td>
      <td>${r.mileage.applied?`<span class="badge ok">반영(${r.mileage.points})</span>`:'<span class="badge gray">미반영</span>'}</td>
      <td>${r.completedAt}</td>
      <td>
        <div class="row-actions-inline">
          <button class="btn" data-detail="${r.applicationId}">상세</button>
          <button class="btn ok" data-complete="${r.applicationId}">이수</button>
          <button class="btn warn" data-revoke="${r.applicationId}">취소</button>
          <button class="btn ok" data-mile-apply="${r.applicationId}">마일리지</button>
          <button class="btn danger" data-mile-cancel="${r.applicationId}">마일리지취소</button>
        </div>
      </td>
    `;
            TB.appendChild(tr);
        });
        syncBulkButtons();
    }

    function renderPagination(){
        const pages = Math.ceil(state.total / state.size)||1;
        const P = $("#pagination"); P.innerHTML = "";
        const makeBtn=(n,lab=String(n))=>{
            const b = el("button","pagebtn"); b.textContent = lab;
            if(n===state.page) b.setAttribute("aria-current","page");
            b.onclick = ()=>{ state.page=n; search(); window.scrollTo({top:0,behavior:"smooth"}); };
            return b;
        }
        P.append(makeBtn(Math.max(1,state.page-1),"‹"));
        for(let i=1;i<=pages;i++){
            if(i===1 || i===pages || Math.abs(i-state.page)<=1) P.append(makeBtn(i));
            else if(P.lastChild && P.lastChild.textContent!=="…"){ const d=el("span"); d.style.padding="8px"; d.textContent="…"; P.append(d); }
        }
        P.append(makeBtn(Math.min(pages,state.page+1),"›"));
    }

    /* ================================
       5) 단건/일괄 액션
       ================================ */
    async function apiPost(url, body){
        // 실제: const r = await fetch(url,{method:"POST",headers:{'Content-Type':'application/json'},body: JSON.stringify(body||{})})
        //       if(!r.ok) throw new Error(await r.text()); return r.json();
        await new Promise(r=>setTimeout(r,300)); // demo
        return {ok:true};
    }

    function selectedIds(){ return Array.from(state.selected); }
    function syncBulkButtons(){
        const hasSel = state.selected.size>0;
        $("#btnBulkComplete").disabled = !hasSel;
        $("#btnBulkRevoke").disabled = !hasSel;
        $("#btnBulkMileageApply").disabled = !hasSel;
        $("#btnBulkMileageCancel").disabled = !hasSel;
        $("#bulkbar").style.display = hasSel ? "flex":"none";
        $("#mBulkComplete").disabled = !hasSel;
        $("#mBulkRevoke").disabled = !hasSel;
        $("#mBulkMileageApply").disabled = !hasSel;
        $("#mBulkMileageCancel").disabled = !hasSel;
    }

    /* ================================
       6) 상세 모달
       ================================ */
    const dlg = $("#dlg");
    async function openDetail(id){
        state.currentDetailId = id;
        // const res = await fetch(ENDPOINTS.detail(id)); const d = await res.json();
        const d = MOCK.rows.find(x=>x.applicationId===id);
        $("#dlgBody").innerHTML = `
    <div class="kv"><div class="muted">학생</div><div>${d.studentNo} / ${d.name} (${d.dept} / ${d.grade}학년)</div></div>
    <div class="kv"><div class="muted">신청유형</div><div>${fmtAppType(d.appType)}</div></div>
    <div class="kv"><div class="muted">출석</div><div>${d.attend.acc}/${d.attend.need} ${d.attend.ok?'<span class="badge ok">충족</span>':'<span class="badge warn">미충족</span>'}</div></div>
    <div class="kv"><div class="muted">만족도</div><div>${d.satisfaction.submitted?`제출(${d.satisfaction.rating}★)`:'미제출'}</div></div>
    <div class="kv"><div class="muted">이수상태</div><div>${d.status==="COMPLETE"?'<span class="badge ok">이수</span>':'<span class="badge danger">미이수</span>'}</div></div>
    <div class="kv"><div class="muted">마일리지</div><div>${d.mileage.applied?`반영(${d.mileage.points})`:'미반영'}</div></div>
    <div class="kv"><div class="muted">이수일시</div><div>${d.completedAt}</div></div>
  `;
        $("#dlgCert").href = `/op/completions/${id}/certificate`;
        dlg.showModal();
    }
    async function doSingle(kind, id){
        const url = kind==="complete" ? ENDPOINTS.complete(id) :
        kind==="revoke" ? ENDPOINTS.revoke(id) :
        kind==="mileApply" ? ENDPOINTS.mileApply(id) :
        ENDPOINTS.mileCancel(id);
        await apiPost(url);
        toast(`처리 완료: ${kind}`,"ok");
        await search();
    }
    async function doBulk(kind){
        const ids = selectedIds();
        if(ids.length===0) return;
        const url = {
            complete: ENDPOINTS.bulkComplete,
            revoke: ENDPOINTS.bulkRevoke,
            mileApply: ENDPOINTS.bulkMileApply,
            mileCancel: ENDPOINTS.bulkMileCancel
        }[kind];
        await apiPost(url,{applicationIds:ids});
        toast(`일괄 처리 완료 (${ids.length}건): ${kind}`,"ok");
        state.selected.clear(); $("#chkAll").checked=false; syncBulkButtons();
        await search();
    }

    /* ================================
       7) 이벤트 바인딩
       ================================ */
    document.addEventListener("change",(e)=>{
        const t = e.target;

        // 전체 선택
        if(t.id==="chkAll"){
            const on = t.checked;
            state.rows.forEach(r=> on ? state.selected.add(r.applicationId) : state.selected.delete(r.applicationId));
            document.querySelectorAll('#tbody input[type="checkbox"]').forEach(c=> c.checked = on);
            syncBulkButtons();
        }

        // 행 체크
        if(t.matches('#tbody input[type="checkbox"]')){
            const id = Number(t.dataset.id);
            if(t.checked) state.selected.add(id); else state.selected.delete(id);
            syncBulkButtons();
        }

        // 프로그램 → 회차 로딩
        if(t.id==="program"){
            loadSchedules(t.value);
        }
    });

    document.addEventListener("click",(e)=>{
        const t = e.target;

        // 검색
        if(t.id==="btnSearch"){ state.page=1; search(); }

        // 초기화
        if(t.id==="btnReset"){
            document.querySelectorAll(".search input").forEach(i=> i.value="");
            document.querySelectorAll(".search select").forEach(s=> s.value="");
            $("#schedule").disabled = true; $("#schedule").innerHTML = "";
            state.page=1; state.selected.clear(); $("#chkAll").checked=false; syncBulkButtons();
            $("#resultHint").textContent = "검색 후 결과가 표시됩니다.";
            $("#tbody").innerHTML=""; $("#pagination").innerHTML="";
        }

        // 엑셀다운로드
        if(t.id==="btnExport"){
            const q = qs(getFilters());
            // 실제: window.location.href = ENDPOINTS.export(q);
            toast("엑셀 생성 요청 전송 (데모)","warn");
        }

        // 상세 링크/버튼
        const detailId = t.dataset.detail;
        if(detailId){ openDetail(Number(detailId)); }

        // 단건 액션
        if(t.dataset.complete){ doSingle("complete", Number(t.dataset.complete)); }
        if(t.dataset.revoke){ doSingle("revoke", Number(t.dataset.revoke)); }
        if(t.dataset.mileApply){ doSingle("mileApply", Number(t.dataset.mileApply)); }
        if(t.dataset.mileCancel){ doSingle("mileCancel", Number(t.dataset.mileCancel)); }

        // 일괄 액션
        if(t.id==="btnBulkComplete" || t.id==="mBulkComplete"){ doBulk("complete"); }
        if(t.id==="btnBulkRevoke" || t.id==="mBulkRevoke"){ doBulk("revoke"); }
        if(t.id==="btnBulkMileageApply" || t.id==="mBulkMileageApply"){ doBulk("mileApply"); }
        if(t.id==="btnBulkMileageCancel" || t.id==="mBulkMileageCancel"){ doBulk("mileCancel"); }
    });

    // 모달 내부 버튼
    $("#dlgComplete").onclick = ()=> doSingle("complete", state.currentDetailId);
    $("#dlgRevoke").onclick = ()=> doSingle("revoke", state.currentDetailId);
    $("#dlgMileageApply").onclick = ()=> doSingle("mileApply", state.currentDetailId);
    $("#dlgMileageCancel").onclick = ()=> doSingle("mileCancel", state.currentDetailId);

    /* ================================
       8) 시작
       ================================ */
    loadPrograms();
</script>
</body>
</html>
