<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8" />
    <title>비교과 포인트 등록 | 운영자</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        :root{
            --bg:#ffffff; --card:#f8fafc; --ink:#0f172a; --sub:#475569; --muted:#94a3b8;
            --pri:#2563eb; --pri-ink:#ffffff; --ok:#16a34a; --warn:#f59e0b; --bad:#ef4444;
            --line:#e2e8f0; --chip:#eef2ff;
            --radius:14px; --gap:12px; --shadow:0 6px 18px rgba(2,6,23,.06);
            --mono: ui-monospace,SFMono-Regular,Consolas,Menlo,monospace;
        }
        *{box-sizing:border-box}
        body{margin:0;background:var(--bg);color:var(--ink);font:15px/1.5 system-ui,-apple-system,Segoe UI,Roboto}
        h1{font-size:20px;margin:16px 0}
        .wrap{max-width:1200px;margin:24px auto;padding:0 16px 64px}
        .toolbar,.panel,.card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow)}
        .toolbar{padding:16px;display:grid;gap:10px;grid-template-columns:repeat(12,1fr);align-items:end}
        .field{display:flex;flex-direction:column;gap:6px}
        .field label{font-size:12px;color:var(--sub)}
        .row{display:flex;gap:8px;align-items:center}
        input[type="text"],input[type="number"],input[type="date"],select{
            width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:10px;background:#fff;color:var(--ink)
        }
        input[type="file"]{border:none;padding:0}
        .btn{appearance:none;border:1px solid var(--pri);background:var(--pri);color:var(--pri-ink);
            padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600}
        .btn.ghost{background:#fff;color:var(--pri)}
        .btn.warn{background:var(--warn);border-color:var(--warn)}
        .btn.bad{background:var(--bad);border-color:var(--bad)}
        .btn.ok{background:var(--ok);border-color:var(--ok)}
        .btn:disabled{opacity:.5;cursor:not-allowed}
        .grid{margin-top:16px;background:#fff;border:1px solid var(--line);border-radius:var(--radius);overflow:auto}
        table{width:100%;border-collapse:collapse;font-size:14px}
        th,td{padding:10px 12px;border-bottom:1px solid var(--line);vertical-align:middle;white-space:nowrap}
        thead th{position:sticky;top:0;background:#f1f5f9;color:#0f172a;z-index:1}
        tbody tr:hover{background:#f8fafc}
        .badge{display:inline-block;padding:2px 8px;border-radius:999px;font-size:12px;background:var(--chip)}
        .badge.ok{background:#ecfdf5;color:#065f46}
        .badge.wait{background:#fff7ed;color:#9a3412}
        .badge.done{background:#eff6ff;color:#1e40af}
        .section-title{margin:20px 0 8px;font-weight:700}
        .panel{padding:16px;margin-top:16px}
        .panel .row{flex-wrap:wrap}
        .muted{color:var(--muted);font-size:12px}
        .flex{display:flex;gap:8px;align-items:center}
        .grow{flex:1}
        .endbar{display:flex;gap:10px;justify-content:flex-end;margin-top:16px}
        .leftbar{display:flex;gap:10px;align-items:center;margin:10px 0}
        .kbd{font-family:var(--mono);font-size:12px;background:#f1f5f9;border:1px solid var(--line);padding:1px 6px;border-radius:6px}
        .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
        /* modal */
        .modal{
            position: fixed;
            inset: 0;
            z-index: 9999;                 /* <- 추가: 배경 모든 요소보다 위 */
            background: rgba(15,23,42,.45);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }

        .modal > .sheet{
            position: relative;            /* <- 추가 */
            z-index: 10000;                /* <- 추가: 내부 헤더/테이블이 확실히 위 */
            background: #fff;
            border: 1px solid var(--line);
            border-radius: 16px;
            box-shadow: var(--shadow);
            max-width: 960px;
            width: 100%;
            max-height: 85vh;
            overflow: hidden;              /* <- 내부 스크롤을 시트 안으로 가둠 */
        }
        .sheet header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid var(--line)}
        .sheet .body{
            padding: 16px;
            overflow: auto;                /* <- 모달 내용 스크롤 */
            max-height: calc(85vh - 56px); /* 헤더 높이만큼 뺀 가시 영역 */
        }

        /* 모달 안의 그리드/헤더가 위로 잘 보이도록 */
        #programModal .grid thead th,
        #historyModal .grid thead th{
            z-index: 3;                    /* sticky 헤더가 모달 시트 내부 최상단 */
        }

        /* 모달 열릴 때 배경 스크롤 잠금 */
        body.modal-open{ overflow: hidden; }

        @media (max-width:960px){
            .toolbar{grid-template-columns:1fr 1fr}
            .hide-sm{display:none}
        }
    </style>
</head>
<body>
<div class="wrap">
    <h1>비교과 포인트 등록</h1>

    <!-- 상단 검색 영역 -->
    <form id="searchForm" class="toolbar" aria-label="검색 영역">
        <div class="field" style="grid-column: span 4;">
            <label for="prog">프로그램 <span class="sr-only">(필수)</span></label>
            <div class="row">
                <input id="prog" name="prog" type="text" placeholder="프로그램명 또는 ID" required aria-required="true" />
                <button type="button" class="btn ghost" id="btnFindProg" title="프로그램 찾기">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                         stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </button>
            </div>
            <div class="muted">예: “진로캠프” 또는 123 (prog_id)</div>
        </div>

        <div class="field" style="grid-column: span 2;">
            <label for="schd">회차</label>
            <select id="schd" name="schd"><option value="">전체</option></select>
        </div>

        <div class="field" style="grid-column: span 3;">
            <label>운영기간</label>
            <div class="row">
                <input type="date" id="from" name="from" />
                <span>~</span>
                <input type="date" id="to" name="to" />
            </div>
        </div>

        <div class="field" style="grid-column: span 2;">
            <label for="dept">부서</label>
            <select id="dept" name="dept"><option value="">전체</option></select>
        </div>

        <div class="field" style="grid-column: span 6;">
            <label for="q">학생검색 (이름/학번)</label>
            <div class="row">
                <input id="q" name="q" type="text" placeholder="예: 김하늘 또는 20231234" />
                <button type="submit" class="btn" id="btnSearch">검색</button>
            </div>
        </div>
    </form>

    <!-- 이수/참가자 목록 -->
    <div class="leftbar">
        <button class="btn ghost" id="btnSelectAll">선택 전체</button>
        <button class="btn ghost" id="btnClearSel">선택 해제</button>
        <span class="muted">선택 <span id="selCount">0</span>명</span>
    </div>
    <div class="grid" role="region" aria-label="참가자 목록" tabindex="0">
        <table id="tblParticipants">
            <thead>
            <tr>
                <th style="width:48px"><input type="checkbox" id="chkAll" aria-label="전체선택" /></th>
                <th>No</th>
                <th>학번</th>
                <th>이름</th>
                <th class="hide-sm">학과</th>
                <th class="hide-sm">학년</th>
                <th>이수상태</th>
                <th>기존포인트</th>
            </tr>
            </thead>
            <tbody id="completionTableBody"><!-- rows --></tbody>
        </table>
    </div>

    <!-- 포인트 부여/차감 패널 -->
    <div class="panel" aria-labelledby="section-assign">
        <div class="section-title" id="section-assign">포인트 부여/차감</div>
        <div class="row">
            <div class="field">
                <label>부여유형 <span class="sr-only">(필수)</span></label>
                <div class="row" role="radiogroup" aria-label="부여유형">
                    <label class="row"><input type="radio" name="type" value="EARN" checked />&nbsp;부여(EARN)</label>
                    <label class="row"><input type="radio" name="type" value="USE" />&nbsp;차감(USE)</label>
                    <label class="row"><input type="radio" name="type" value="ADJUST" />&nbsp;조정(ADJUST)</label>
                </div>
                <div class="muted">차감/조정은 내부 검증 규칙에 따릅니다.</div>
            </div>
            <div class="field" style="min-width:180px;">
                <label for="points">포인트 <span class="sr-only">(필수)</span></label>
                <input id="points" type="number" inputmode="numeric" min="1" step="1" placeholder="숫자" required />
            </div>
            <div class="field grow">
                <label for="reason">사유 <span class="sr-only">(필수)</span></label>
                <input id="reason" type="text" maxlength="200" placeholder="예: 프로그램 이수 마일리지 부여" required />
                <div class="muted">최대 200자</div>
            </div>
        </div>

        <div class="row" style="margin-top:8px">
            <button class="btn ghost" id="btnTemplate" type="button">양식 다운로드</button>
            <label class="btn ghost" for="excel">엑셀 업로드</label>
            <input id="excel" type="file" accept=".xlsx,.xls,.csv" class="sr-only" />
            <span class="muted">템플릿: <span class="kbd">studentNo, points, type, description</span></span>
        </div>

        <div class="endbar">
            <button class="btn ok"   id="btnDraft"   type="button">임시저장</button>
            <button class="btn"      id="btnCommit"  type="button">일괄적용</button>
            <button class="btn"      id="btnSingle"  type="button">개별적용</button>
            <button class="btn ghost" id="btnReset"  type="button">취소</button>
            <button class="btn ghost" id="btnHistory" type="button">이력조회</button>
        </div>
    </div>

    <!-- 미리보기/임시내역 -->
    <div class="card" style="margin-top:16px">
        <div class="section-title">미리보기 / 임시내역</div>
        <div class="grid" role="region" aria-label="미리보기 그리드" tabindex="0">
            <table id="tblPreview">
                <thead>
                <tr>
                    <th style="width:48px"></th>
                    <th>학번</th>
                    <th>이름</th>
                    <th>유형</th>
                    <th>포인트</th>
                    <th>사유</th>
                    <th>비고</th>
                </tr>
                </thead>
                <tbody><!-- rows --></tbody>
            </table>
        </div>
    </div>
</div>

<!-- 프로그램 검색 모달 -->
<div class="modal" id="programModal" aria-hidden="true" aria-label="프로그램 검색 모달">
    <div class="sheet">
        <header>
            <strong>프로그램 검색</strong>
            <button class="btn ghost" id="btnProgClose" type="button">닫기</button>
        </header>
        <div class="body">
            <form id="progSearchForm" class="row" style="margin-bottom:12px">
                <input id="progKeyword" type="text" placeholder="프로그램명/설명/담당자 검색" style="min-width:260px" />
                <select id="progStatus" title="상태">
                    <option value="">상태전체</option>
                    <option value="COMPLETED">COMPLETED</option>
                    <option value="APPROVED">APPROVED</option>
                    <option value="ONGOING">ONGOING</option>
                </select>
                <button class="btn" type="submit" id="btnProgSearch">검색</button>
            </form>

            <div class="grid" role="region" aria-label="프로그램 검색 결과" tabindex="0">
                <table id="tblProgram">
                    <thead>
                    <tr>
                        <th style="width:90px">ID</th>
                        <th>제목</th>
                        <th>부서</th>
                        <th>기간</th>
                        <th>상태</th>
                        <th style="width:80px">선택</th>
                    </tr>
                    </thead>
                    <tbody><!-- rows --></tbody>
                </table>
            </div>

            <div class="endbar">
                <button class="btn ghost" id="btnProgPrev" type="button">이전</button>
                <span class="muted" id="progPageInfo">1 / 1</span>
                <button class="btn ghost" id="btnProgNext" type="button">다음</button>
            </div>
        </div>
    </div>
</div>

<!-- 포인트 이력 모달 -->
<div class="modal" id="historyModal" aria-hidden="true" aria-label="포인트 이력 모달">
    <div class="sheet">
        <header>
            <strong>포인트 이력</strong>
            <button class="btn ghost" id="btnCloseModal" type="button">닫기</button>
        </header>
        <div class="body">
            <div class="grid">
                <table id="tblHistory">
                    <thead>
                    <tr>
                        <th>일시</th>
                        <th>학번</th>
                        <th>이름</th>
                        <th>유형</th>
                        <th>포인트</th>
                        <th>사유</th>
                        <th>등록자</th>
                    </tr>
                    </thead>
                    <tbody><!-- rows --></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    // ===================== 설정: API 엔드포인트 =====================
    const API = {
        eligible:   '/api/op/mileages/eligible',          // GET ?progId=&schdId=&q=&from=&to=&dept=
        schedules:  '/api/op/programs/{progId}/schedules',// GET 회차 로드
        template:   '/api/op/mileages/template',          // GET
        upload:     '/api/op/mileages/upload',            // POST (form-data)
        draft:      '/api/op/mileages/draft',             // POST
        commit:     '/api/op/mileages/commit',            // POST
        history:    '/api/op/mileages/history',           // GET ?progId=&schdId=
        programSearch: '/api/op/programs/search'          // GET ?q=&status=&page=&size=
    };

    // ===================== 상태 =====================
    const state = {
        participants: [],     // 검색 결과
        previewRows: [],      // 미리보기(개별 수정 반영)
        selectedIds: new Set(),
        draftId: null,
        programId: null,
        scheduleId: null
    };
    const pState = { page: 0, size: 10, totalPages: 1, lastQuery: { q:'', status:'' } };

    // ===================== 유틸 =====================
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const toast = msg => { alert(msg); }; // 필요시 토스트 라이브러리로 교체

    function fmtBadge(status){
        if(status === 'COMPLETED') return '<span class="badge ok">이수</span>';
        if(status === 'ATTENDED')  return '<span class="badge done">참여</span>';
        return '<span class="badge wait">'+(status||'-')+'</span>';
    }
    function currentType(){
        return (document.querySelector('input[name="type"]:checked') || {}).value || 'EARN';
    }
    function validateCore(){
        const prog = $('#prog').value.trim();
        if(!prog){ $('#prog').focus(); throw new Error('프로그램을 입력하세요.'); }
        const pts = +($('#points').value || 0);
        if(!(pts>=1)) { $('#points').focus(); throw new Error('포인트는 1 이상이어야 합니다.'); }
        const reason = $('#reason').value.trim();
        if(reason.length===0){ $('#reason').focus(); throw new Error('사유를 입력하세요.'); }
        return {prog, pts, reason};
    }
    function refreshSelCount(){
        $('#selCount').textContent = state.selectedIds.size;
        $('#chkAll').checked = state.participants.length>0 && state.selectedIds.size===state.participants.length;
    }

    // ===================== 참가자 렌더링 =====================
    function renderParticipants(){
        const tb = $('#tblParticipants tbody');
        tb.innerHTML = '';
        state.participants.forEach((p,idx)=>{
            const tr = document.createElement('tr');
            const checked = state.selectedIds.has(p.applicationId || p.studentId);
            tr.innerHTML = `
          <td><input type="checkbox" data-id="${p.applicationId || p.studentId}" ${checked?'checked':''} /></td>
          <td>${idx+1}</td>
          <td>${p.studentNo||'-'}</td>
          <td>${p.name||'-'}</td>
          <td class="hide-sm">${p.dept||'-'}</td>
          <td class="hide-sm">${p.grade??'-'}</td>
          <td>${fmtBadge(p.completionStatus||p.status)}</td>
          <td style="text-align:right">${p.existingPoints??0}</td>
        `;
            tb.appendChild(tr);
        });
        refreshSelCount();
    }
    function renderPreview(){
        const tb = $('#tblPreview tbody');
        tb.innerHTML = '';
        state.previewRows.forEach((r,idx)=>{
            const tr = document.createElement('tr');
            tr.innerHTML = `
          <td><input type="checkbox" data-idx="${idx}" /></td>
          <td>${r.studentNo}</td>
          <td>${r.name||'-'}</td>
          <td>
            <select data-edit="type" data-idx="${idx}">
              <option value="EARN"   ${r.type==='EARN'?'selected':''}>EARN</option>
              <option value="USE"    ${r.type==='USE'?'selected':''}>USE</option>
              <option value="ADJUST" ${r.type==='ADJUST'?'selected':''}>ADJUST</option>
            </select>
          </td>
          <td><input type="number" min="1" step="1" value="${r.points}" data-edit="points" data-idx="${idx}" style="width:110px" /></td>
          <td><input type="text" value="${r.description||''}" data-edit="desc" data-idx="${idx}" style="width:320px" /></td>
          <td>${r.remark||''}</td>
        `;
            tb.appendChild(tr);
        });
    }
    function appendPreviewFromSelection(){
        const {pts, reason} = { pts:+$('#points').value, reason:$('#reason').value.trim() };
        const type = currentType();
        const selAppIds = Array.from(state.selectedIds);
        const candidate = state.participants.filter(p => selAppIds.includes(p.applicationId||p.studentId));
        const rows = candidate.map(p=>({
            studentId: p.studentId, studentNo: p.studentNo, name: p.name,
            programId: state.programId, scheduleId: state.scheduleId || null,
            type, points: pts, description: reason
        }));
        const key = o=>[o.studentId,o.programId,o.description,o.points,o.type].join('|');
        const exist = new Set(state.previewRows.map(key));
        rows.forEach(r=>{ if(!exist.has(key(r))) state.previewRows.push(r); });
        renderPreview();
    }

    // ===================== 모달 공통 =====================
    function openModal(open){
        const m = $('#historyModal');
        m.style.display = open ? 'flex' : 'none';
        m.setAttribute('aria-hidden', open ? 'false' : 'true');
    }
    $('#btnCloseModal').addEventListener('click', ()=>openModal(false));
    $('#historyModal').addEventListener('click', (e)=>{ if(e.target.id==='historyModal') openModal(false); });

    // ===================== 프로그램 검색 모달 =====================
    function openProgModal(open){
        const m = $('#programModal');
        m.style.display = open ? 'flex' : 'none';
        m.setAttribute('aria-hidden', open ? 'false' : 'true');
    }
    function renderPrograms(list){
        const tb = $('#tblProgram tbody'); tb.innerHTML='';
        (list||[]).forEach(p=>{
            const tr = document.createElement('tr');
            tr.dataset.id = p.id || p.programId;
            tr.dataset.title = p.title;
            tr.innerHTML = `
          <td>${p.id || p.programId}</td>
          <td style="max-width:420px;overflow:hidden;text-overflow:ellipsis">${p.title||'-'}</td>
          <td>${p.deptName||p.departmentName||'-'}</td>
          <td>${p.periodText||'-'}</td>
          <td>${p.status||'-'}</td>
          <td><button class="btn ghost btn-choose" type="button">선택</button></td>
        `;
            tb.appendChild(tr);
        });
        $('#progPageInfo').textContent = `${pState.page+1} / ${pState.totalPages}`;
    }
    async function fetchPrograms({q, status, page=0, size=10}){
        const params = new URLSearchParams();
        if(q) params.set('q', q);
        if(status) params.set('status', status);
        params.set('page', page); params.set('size', size);
        const res = await fetch(`${API.programSearch}?${params.toString()}`);
        if(!res.ok) throw new Error('프로그램 검색 실패');
        const data = await res.json();
        const list = data.content || data.items || data || [];
        const totalPages = data.totalPages || 1;
        pState.page = page; pState.size = size; pState.totalPages = totalPages;
        pState.lastQuery = { q, status };
        renderPrograms(list);
    }
    function applySelectedProgram(id, title){
        $('#prog').value = `${title} (${id})`;
        state.programId = Number(id);
        fetch(API.schedules.replace('{progId}', id))
            .then(r=>r.ok?r.json():[])
            .then(arr=>{
            $('#schd').innerHTML = '<option value="">전체</option>' + (arr||[]).map(s=>`<option value="${s.scheduleId}">${s.name||s.sessionName||('회차#'+s.scheduleId)}</option>`).join('');
        })
            .finally(()=> openProgModal(false));
    }

    /* ------------------------------ 더미 페이징 함수 ------------------------------ */
    async function fetchPrograms({q, status, page=0, size=10}){
        // 검색 조건 필터링
        let filtered = dummyPrograms.filter(p=>{
            const kw = (q||'').toLowerCase();
            const matchQ = !kw || p.title.toLowerCase().includes(kw) || p.deptName.toLowerCase().includes(kw);
            const matchStatus = !status || p.status===status;
            return matchQ && matchStatus;
        });
        const totalPages = Math.ceil(filtered.length / size);
        const list = filtered.slice(page*size, page*size + size);

        // JSON 응답 모방
        const data = {
            content: list,
            totalPages: totalPages,
            totalElements: filtered.length,
            number: page,
            size: size
        };
        // 기존 렌더 함수 호출
        pState.page = page; pState.size = size; pState.totalPages = totalPages;
        pState.lastQuery = { q, status };
        renderPrograms(data.content);
    }

    // 테이블 렌더링 함수
    function renderStudentList(list) {
        const tbody = document.getElementById("completionTableBody");
        tbody.innerHTML = ""; // 초기화

        list.forEach((item, index) => {
            tbody.insertAdjacentHTML(
                "beforeend",
                `
                <tr>
                  <td>${index + 1}</td>
                  <td>${item.studentNo}</td>
                  <td>${item.name}</td>
                  <td>${item.dept}</td>
                  <td>${item.grade}</td>
                  <td>${item.attendanceRate}%</td>
                  <td>${item.score}</td>
                  <td><span class="badge-pass">${item.pass}</span></td>
                  <td>${item.mileageGranted}</td>
                </tr>
                `
            );
        });
    }

    // ===================== 이벤트 =====================
    // 검색 submit
    // 전역 토글 (체크박스나 환경에 맞게 바꾸면 됨)
    window.USE_DUMMY = true; // 더미 쓰면 true, 실제 API 쓰면 false

    // 기존에 바인딩된 핸들러 제거 방지용: 동일 핸들러 레퍼런스로 관리
    function onSearchSubmit(e) {
        e.preventDefault();

        try {
            // 공통: 폼 값
            const progVal = $('#prog')?.value?.trim() || '';
            const schdVal = $('#schd')?.value || '';
            const keyword = ($('#q')?.value || '').trim();
            const from = $('#from')?.value || '';
            const to   = $('#to')?.value || '';
            const dept = $('#dept')?.value || '';

            // 프로그램 ID 업데이트(숫자만)
            if (!progVal) throw new Error('프로그램을 입력하세요.');
            state.programId = /^\d+$/.test(progVal) ? Number(progVal) : state.programId;

            // 더미 모드: dummyResponse에서 필터 후 기존 렌더 함수 재사용
            if (window.USE_DUMMY) {
                const src = (window.dummyResponse?.content) || [];
                const filtered = src.filter(item =>
                (!keyword || item.name.includes(keyword) || item.studentNo.includes(keyword) || item.dept.includes(keyword)) &&
                (!dept || item.dept === dept)
                    // 필요하면 from/to, schdVal에 대한 조건 추가
                );

                // 기존 화면 흐름에 맞게 state 갱신 후 렌더
                state.participants = filtered;
                state.selectedIds?.clear?.();
                renderParticipants();   // ← 네가 쓰는 기존 테이블 렌더 함수

                // 회차 셀렉트 박스 더미도 채워야 하면 아래 주석 해제해서 사용
                /*
                const schdOptions = ['전체', '1회차(2025-05-10 10:00)']; // 예시
                $('#schd').innerHTML = schdOptions
                  .map((label, i) => i===0 ? `<option value="">${label}</option>` : `<option value="${1000+i}">${label}</option>`)
                  .join('');
                */
                return; // 더미 모드 종료
            }

            // 실제 API 모드
            const params = new URLSearchParams();
            if (state.programId) params.set('progId', state.programId);
            if (schdVal){ params.set('schdId', schdVal); state.scheduleId = schdVal; }
            if (keyword) params.set('q', keyword);
            if (from) params.set('from', from);
            if (to)   params.set('to', to);
            if (dept) params.set('dept', dept);

            fetch(`${API.eligible}?${params.toString()}`)
                .then(res => {
                if (!res.ok) throw new Error('참가자 조회 실패');
                return res.json();
            })
                .then(data => {
                state.participants = Array.isArray(data.items) ? data.items : (data.content || data || []);
                state.selectedIds.clear();
                renderParticipants();
            })
                .catch(err => toast(err.message || String(err)));

            // 회차 재조회
            if (state.programId){
                fetch(API.schedules.replace('{progId}', state.programId))
                    .then(sres => sres.ok ? sres.json() : null)
                    .then(arr => {
                    if (!arr) return;
                    $('#schd').innerHTML =
                    '<option value="">전체</option>' +
                    (arr||[]).map(s=>`<option value="${s.scheduleId}">${s.name||s.sessionName||('회차#'+s.scheduleId)}</option>`).join('');
                })
                    .catch(()=>{ /* 회차 실패 무시 */ });
            }
        } catch(err) {
            toast(err.message || String(err));
        }
    }

    // 기존 중복 바인딩 방지: 일단 remove 후 add
    const formEl = document.getElementById('searchForm');
    if (formEl) {
        formEl.removeEventListener('submit', onSearchSubmit);
        formEl.addEventListener('submit', onSearchSubmit);
    }

    //    $('#searchForm').addEventListener('submit', async (e)=>{
//        e.preventDefault();
//        try{
//            const progVal = $('#prog').value.trim();
//            if(!progVal) throw new Error('프로그램을 입력하세요.');
//            state.programId = /^\d+$/.test(progVal) ? Number(progVal) : state.programId;
//
//            const params = new URLSearchParams();
//            if(state.programId) params.set('progId', state.programId);
//            const schd = $('#schd').value; if(schd){ params.set('schdId', schd); state.scheduleId = schd; }
//            const q = $('#q').value.trim(); if(q) params.set('q', q);
//            const from = $('#from').value; if(from) params.set('from', from);
//            const to   = $('#to').value;   if(to)   params.set('to', to);
//            const dept = $('#dept').value; if(dept) params.set('dept', dept);
//
//            const res = await fetch(`${API.eligible}?${params.toString()}`);
//            if(!res.ok) throw new Error('참가자 조회 실패');
//            const data = await res.json();
//            state.participants = Array.isArray(data.items) ? data.items : (data.content || data || []);
//            state.selectedIds.clear();
//            renderParticipants();
//
//            if(state.programId){
//                const sres = await fetch(API.schedules.replace('{progId}', state.programId));
//                if (sres.ok){
//                    const arr = await sres.json();
//                    $('#schd').innerHTML = '<option value="">전체</option>' + (arr||[]).map(s=>`<option value="${s.scheduleId}">${s.name||s.sessionName||('회차#'+s.scheduleId)}</option>`).join('');
//                }
//            }
//        }catch(err){ toast(err.message||String(err)); }
//    });

    // 전체 선택/해제
    $('#chkAll').addEventListener('change', (e)=>{
        if(e.target.checked){
            state.participants.forEach(p=> state.selectedIds.add(p.applicationId||p.studentId));
        }else{
            state.selectedIds.clear();
        }
        renderParticipants();
    });
    $('#btnSelectAll').addEventListener('click', ()=>{
        state.participants.forEach(p=> state.selectedIds.add(p.applicationId||p.studentId));
        renderParticipants();
    });
    $('#btnClearSel').addEventListener('click', ()=>{
        state.selectedIds.clear(); renderParticipants();
    });

    // 행 체크
    $('#tblParticipants').addEventListener('change', (e)=>{
        if(e.target.matches('input[type="checkbox"][data-id]')){
            const id = isNaN(+e.target.dataset.id) ? e.target.dataset.id : +e.target.dataset.id;
            if(e.target.checked) state.selectedIds.add(id); else state.selectedIds.delete(id);
            refreshSelCount();
        }
    });

    // 미리보기 편집
    $('#tblPreview').addEventListener('input', (e)=>{
        const idx = +e.target.dataset.idx;
        if(Number.isNaN(idx)) return;
        if(e.target.dataset.edit==='points'){
            state.previewRows[idx].points = Math.max(1, parseInt(e.target.value||'1',10));
        }else if(e.target.dataset.edit==='desc'){
            state.previewRows[idx].description = e.target.value;
        }else if(e.target.dataset.edit==='type'){
            state.previewRows[idx].type = e.target.value;
        }
    });

    // 템플릿
    $('#btnTemplate').addEventListener('click', ()=>{
        window.location.href = API.template;
    });

    // 엑셀 업로드 → 미리보기
    $('#excel').addEventListener('change', async (e)=>{
        const file = e.target.files[0];
        if(!file) return;
        const fd = new FormData(); fd.append('file', file);
        try{
            const res = await fetch(API.upload, { method:'POST', body: fd });
            if(!res.ok) throw new Error('엑셀 업로드 실패');
            const rows = await res.json(); // [{studentNo, points, type, description, ...}]
            const normalized = (rows||[]).map(r=>({
                studentId: r.studentId, studentNo: r.studentNo, name: r.name,
                programId: state.programId, scheduleId: state.scheduleId || null,
                type: r.type || 'EARN', points: Math.max(1, parseInt(r.points||'1',10)),
                description: r.description || ''
            }));
            state.previewRows = normalized;
            renderPreview();
            toast('엑셀을 미리보기에 반영했어요.');
        }catch(err){ toast(err.message||String(err)); }
        finally{ e.target.value=''; }
    });

    // 임시저장
    $('#btnDraft').addEventListener('click', async ()=>{
        try{
            validateCore();
            appendPreviewFromSelection();
            if(state.previewRows.length===0) throw new Error('미리보기에 반영할 항목이 없습니다.');
            const res = await fetch(API.draft, {
                method:'POST', headers:{'Content-Type':'application/json'},
                body: JSON.stringify({ items: state.previewRows, programId: state.programId, scheduleId: state.scheduleId })
            });
            if(!res.ok) throw new Error('임시저장 실패');
            const data = await res.json();
            state.draftId = data.draftId || data.id || null;
            toast('임시저장 완료');
        }catch(err){ toast(err.message||String(err)); }
    });

    // 일괄적용
    $('#btnCommit').addEventListener('click', async ()=>{
        try{
            validateCore();
            appendPreviewFromSelection();
            if(state.previewRows.length===0) throw new Error('등록할 항목이 없습니다.');
            if(!confirm('선택/미리보기의 전체 항목을 확정 등록하시겠습니까?')) return;
            const res = await fetch(API.commit, {
                method:'POST', headers:{'Content-Type':'application/json'},
                body: JSON.stringify({ items: state.previewRows, programId: state.programId, scheduleId: state.scheduleId })
            });
            if(!res.ok) throw new Error('일괄 등록 실패');
            toast('일괄 등록 완료');
            state.previewRows = []; renderPreview();
        }catch(err){ toast(err.message||String(err)); }
    });

    // 개별적용
    $('#btnSingle').addEventListener('click', async ()=>{
        const checkedIdx = $$('#tblPreview tbody input[type="checkbox"][data-idx]:checked').map(x=>+x.dataset.idx);
        if(checkedIdx.length===0){ toast('개별 적용할 행을 체크하세요.'); return; }
        try{
            const items = checkedIdx.map(i=>state.previewRows[i]);
            const res = await fetch(API.commit+'?mode=single', {
                method:'POST', headers:{'Content-Type':'application/json'},
                body: JSON.stringify({ items, programId: state.programId, scheduleId: state.scheduleId })
            });
            if(!res.ok) throw new Error('개별 등록 실패');
            toast('개별 등록 완료');
            state.previewRows = state.previewRows.filter((_,i)=>!checkedIdx.includes(i));
            renderPreview();
        }catch(err){ toast(err.message||String(err)); }
    });

    // 취소
    $('#btnReset').addEventListener('click', ()=>{
        if(!confirm('입력값과 미리보기를 초기화할까요?')) return;
        state.previewRows = []; renderPreview();
        state.selectedIds.clear(); renderParticipants();
        $('#points').value=''; $('#reason').value='';
    });

    // 이력조회
    $('#btnHistory').addEventListener('click', async ()=>{
        try{
            const progVal = $('#prog').value.trim();
            if(!progVal) throw new Error('프로그램을 입력하세요.');
            const params = new URLSearchParams();
            params.set('progId', state.programId || progVal);
            if(state.scheduleId) params.set('schdId', state.scheduleId);
            const res = await fetch(`${API.history}?${params.toString()}`);
            if(!res.ok) throw new Error('이력 조회 실패');
            const items = await res.json(); // [{createdAt, studentNo, name, type, points, description, createdBy}]
            const tb = $('#tblHistory tbody'); tb.innerHTML='';
            (items.content || items || []).forEach(h=>{
                const tr = document.createElement('tr');
                tr.innerHTML = `
            <td>${h.createdAt||'-'}</td>
            <td>${h.studentNo||'-'}</td>
            <td>${h.name||'-'}</td>
            <td>${h.type||'-'}</td>
            <td style="text-align:right">${h.points??0}</td>
            <td>${h.description||''}</td>
            <td>${h.createdBy||'-'}</td>
          `;
                tb.appendChild(tr);
            });
            openModal(true);
        }catch(err){ toast(err.message||String(err)); }
    });

    // 프로그램 검색: 열기 & 기본 검색
    $('#btnFindProg').addEventListener('click', async ()=>{
        openProgModal(true);
        const kw = $('#prog').value.replace(/\(\d+\)\s*$/,'').trim();
        $('#progKeyword').value = kw;
        try{
            await fetchPrograms({ q: kw, status: 'COMPLETED', page: 0, size: 10 });
        }catch(e){ toast(e.message||String(e)); }
    });
    // 프로그램 검색: 닫기/외부 클릭
    $('#btnProgClose').addEventListener('click', ()=>openProgModal(false));
    $('#programModal').addEventListener('click', (e)=>{ if(e.target.id==='programModal') openProgModal(false); });
    // 프로그램 검색: 검색 submit
    $('#progSearchForm').addEventListener('submit', async (e)=>{
        e.preventDefault();
        try{
            await fetchPrograms({ q: $('#progKeyword').value.trim(), status: $('#progStatus').value, page: 0, size: pState.size });
        }catch(err){ toast(err.message||String(err)); }
    });
    // 프로그램 검색: 페이지 이동
    $('#btnProgPrev').addEventListener('click', async ()=>{
        if(pState.page<=0) return;
        await fetchPrograms({ ...pState.lastQuery, page: pState.page-1, size: pState.size });
    });
    $('#btnProgNext').addEventListener('click', async ()=>{
        if(pState.page>=pState.totalPages-1) return;
        await fetchPrograms({ ...pState.lastQuery, page: pState.page+1, size: pState.size });
    });
    // 프로그램 검색: 선택/더블클릭
    $('#tblProgram').addEventListener('click', (e)=>{
        if(e.target.classList.contains('btn-choose')){
            const tr = e.target.closest('tr'); if(!tr) return;
            applySelectedProgram(tr.dataset.id, tr.dataset.title);
        }
    });
    $('#tblProgram').addEventListener('dblclick', (e)=>{
        const tr = e.target.closest('tr'); if(!tr) return;
        applySelectedProgram(tr.dataset.id, tr.dataset.title);
    });

    // 단축키
    document.addEventListener('keydown', (e)=>{
        if(e.ctrlKey && e.key==='Enter'){ $('#btnSearch').click(); }
        if(e.key==='Escape' && $('#programModal').getAttribute('aria-hidden')==='false'){ openProgModal(false); }
    });




    // ===================== 부서 콤보 더미 바인딩 (async IIFE 수정 버전) =====================
    (async () => {
        $('#dept').innerHTML += `
        <option value="NCL">비교과센터</option>
        <option value="JOB">취업지원</option>
      `;
    })();

    /* ------------------------------ 더미 프로그램 데이터 ------------------------------ */
    const dummyPrograms = [

        { id: 101, title: "진로캠프 1기", deptName: "비교과센터", periodText: "2025-05-01 ~ 2025-05-31", status: "COMPLETED" },
        { id: 102, title: "진로캠프 2기", deptName: "비교과센터", periodText: "2025-06-01 ~ 2025-06-30", status: "APPROVED" },
        { id: 103, title: "창의력 향상 워크숍", deptName: "비교과센터", periodText: "2025-04-10 ~ 2025-04-12", status: "COMPLETED" },
        { id: 104, title: "취업멘토링 데이", deptName: "취업지원", periodText: "2025-07-01 ~ 2025-07-15", status: "ONGOING" },
        { id: 105, title: "리더십 아카데미", deptName: "비교과센터", periodText: "2025-03-01 ~ 2025-03-31", status: "COMPLETED" },
        { id: 106, title: "봉사활동 리더 양성", deptName: "사회봉사단", periodText: "2025-02-10 ~ 2025-02-20", status: "COMPLETED" },
        { id: 107, title: "글로벌 마인드 캠프", deptName: "국제교류원", periodText: "2025-09-01 ~ 2025-09-05", status: "APPROVED" },
        { id: 108, title: "학습코칭 프로그램", deptName: "비교과센터", periodText: "2025-05-15 ~ 2025-05-20", status: "COMPLETED" },
        { id: 109, title: "프레젠테이션 스킬업", deptName: "비교과센터", periodText: "2025-06-10 ~ 2025-06-12", status: "ONGOING" },
        { id: 110, title: "커뮤니케이션 훈련", deptName: "비교과센터", periodText: "2025-08-10 ~ 2025-08-15", status: "APPROVED" },
        { id: 111, title: "창업 아이디어톤", deptName: "창업지원단", periodText: "2025-10-01 ~ 2025-10-05", status: "APPROVED" },
        { id: 112, title: "프로젝트 관리 역량 강화", deptName: "비교과센터", periodText: "2025-11-01 ~ 2025-11-15", status: "COMPLETED" },
        { id: 113, title: "AI 이해와 실습", deptName: "비교과센터", periodText: "2025-05-10 ~ 2025-05-14", status: "COMPLETED" },
        { id: 114, title: "코딩 입문 부트캠프", deptName: "비교과센터", periodText: "2025-03-20 ~ 2025-03-24", status: "COMPLETED" },
        { id: 115, title: "데이터 분석 워크숍", deptName: "비교과센터", periodText: "2025-09-05 ~ 2025-09-10", status: "APPROVED" },
        { id: 116, title: "리더십 향상 세미나", deptName: "비교과센터", periodText: "2025-10-01 ~ 2025-10-10", status: "COMPLETED" },
        { id: 117, title: "자기주도 학습법", deptName: "비교과센터", periodText: "2025-01-05 ~ 2025-01-08", status: "COMPLETED" },
        { id: 118, title: "NCS 직무적성 역량훈련", deptName: "취업지원", periodText: "2025-06-15 ~ 2025-06-20", status: "APPROVED" },
        { id: 119, title: "진로탐색 그룹상담", deptName: "학생상담센터", periodText: "2025-07-01 ~ 2025-07-10", status: "ONGOING" },
        { id: 120, title: "멘토-멘티 프로그램", deptName: "비교과센터", periodText: "2025-08-01 ~ 2025-08-30", status: "COMPLETED" }
    ];
    const dummyResponse = [
    {
    "program": {
    "programId": 101,
    "title": "진로캠프 1기",
    "batch": "1기",
    "periodText": "2025-05-01 ~ 2025-05-31"
    },
    "content": [
    {
    "completionId": 5001,
    "applicationId": 30001,
    "studentId": 20001,
    "studentNo": "20210001",
    "name": "김하늘",
    "dept": "경영학과",
    "grade": 3,
    "phone": "010-3211-0001",
    "scheduleId": 1001,
    "scheduleName": "1회차(2025-05-10 10:00)",
    "completedAt": "2025-05-31T16:20:00",
    "attendanceRate": 96,
    "score": 92,
    "pass": "PASS",
    "mileageGranted": 10,
    "certificateNo": "CERT-101-0001"
    },
    {
    "completionId": 5002,
    "applicationId": 30002,
    "studentId": 20002,
    "studentNo": "20210002",
    "name": "이서연",
    "dept": "컴퓨터공학과",
    "grade": 2,
    "phone": "010-3211-0002",
    "scheduleId": 1001,
    "scheduleName": "1회차(2025-05-10 10:00)",
    "completedAt": "2025-05-31T16:22:00",
    "attendanceRate": 90,
    "score": 88,
    "pass": "PASS",
    "mileageGranted": 10,
    "certificateNo": "CERT-101-0002"
    },
    {
    "completionId": 5003,
    "applicationId": 30003,
    "studentId": 20003,
    "studentNo": "20210003",
    "name": "박지호",
    "dept": "심리학과",
    "grade": 4,
    "phone": "010-3211-0003",
    "scheduleId": 1001,
    "scheduleName": "1회차(2025-05-10 10:00)",
    "completedAt": "2025-05-31T16:24:00",
    "attendanceRate": 100,
    "score": 95,
    "pass": "PASS",
    "mileageGranted": 10,
    "certificateNo": "CERT-101-0003"
    },
    {
    "completionId": 5004,
    "applicationId": 30004,
    "studentId": 20004,
    "studentNo": "20210004",
    "name": "최수빈",
    "dept": "국어국문학과",
    "grade": 1,
    "phone": "010-3211-0004",
    "scheduleId": 1001,
    "scheduleName": "1회차(2025-05-10 10:00)",
    "completedAt": "2025-05-31T16:26:00",
    "attendanceRate": 88,
    "score": 84,
    "pass": "PASS",
    "mileageGranted": 10,
    "certificateNo": "CERT-101-0004"
    },
    {
    "completionId": 5005,
    "applicationId": 30005,
    "studentId": 20005,
    "studentNo": "20210005",
    "name": "정다은",
    "dept": "디자인학과",
    "grade": 2,
    "phone": "010-3211-0005",
    "scheduleId": 1001,
    "scheduleName": "1회차(2025-05-10 10:00)",
    "completedAt": "2025-05-31T16:28:00",
    "attendanceRate": 93,
    "score": 90,
    "pass": "PASS",
    "mileageGranted": 10,
    "certificateNo": "CERT-101-0005"
    },
    {
    "completionId": 5006,
    "applicationId": 30006,
    "studentId": 20006,
    "studentNo": "20210006",
    "name": "오민준",
    "dept": "경제학과",
    "grade": 3,
    "phone": "010-3211-0006",
    "scheduleId": 1001,
    "scheduleName": "1회차(2025-05-10 10:00)",
    "completedAt": "2025-05-31T16:30:00",
    "attendanceRate": 85,
    "score": 81,
    "pass": "PASS",
    "mileageGranted": 10,
    "certificateNo": "CERT-101-0006"
    },
    {
    "completionId": 5007,
    "applicationId": 30007,
    "studentId": 20007,
    "studentNo": "20210007",
    "name": "한예린",
    "dept": "간호학과",
    "grade": 2,
    "phone": "010-3211-0007",
    "scheduleId": 1001,
    "scheduleName": "1회차(2025-05-10 10:00)",
    "completedAt": "2025-05-31T16:32:00",
    "attendanceRate": 97,
    "score": 94,
    "pass": "PASS",
    "mileageGranted": 10,
    "certificateNo": "CERT-101-0007"
    },
    {
    "completionId": 5008,
    "applicationId": 30008,
    "studentId": 20008,
    "studentNo": "20210008",
    "name": "서지민",
    "dept": "화학과",
    "grade": 1,
    "phone": "010-3211-0008",
    "scheduleId": 1001,
    "scheduleName": "1회차(2025-05-10 10:00)",
    "completedAt": "2025-05-31T16:34:00",
    "attendanceRate": 82,
    "score": 78,
    "pass": "PASS",
    "mileageGranted": 10,
    "certificateNo": "CERT-101-0008"
    },
    {
    "completionId": 5009,
    "applicationId": 30009,
    "studentId": 20009,
    "studentNo": "20210009",
    "name": "문채원",
    "dept": "사회복지학과",
    "grade": 4,
    "phone": "010-3211-0009",
    "scheduleId": 1001,
    "scheduleName": "1회차(2025-05-10 10:00)",
    "completedAt": "2025-05-31T16:36:00",
    "attendanceRate": 91,
    "score": 86,
    "pass": "PASS",
    "mileageGranted": 10,
    "certificateNo": "CERT-101-0009"
    },
    {
    "completionId": 5010,
    "applicationId": 30010,
    "studentId": 20010,
    "studentNo": "20210010",
    "name": "강현우",
    "dept": "전자공학과",
    "grade": 3,
    "phone": "010-3211-0010",
    "scheduleId": 1001,
    "scheduleName": "1회차(2025-05-10 10:00)",
    "completedAt": "2025-05-31T16:38:00",
    "attendanceRate": 95,
    "score": 90,
    "pass": "PASS",
    "mileageGranted": 10,
    "certificateNo": "CERT-101-0010"
    },

    {
    "completionId": 5011,
    "applicationId": 30011,
    "studentId": 20011,
    "studentNo": "20210011",
    "name": "신가온",
    "dept": "체육학과",
    "grade": 1,
    "phone": "010-3211-0011",
    "scheduleId": 1001,
    "scheduleName": "1회차(2025-05-10 10:00)",
    "completedAt": "2025-05-31T16:40:00",
    "attendanceRate": 86,
    "score": 80,
    "pass": "PASS",
    "mileageGranted": 10,
    "certificateNo": "CERT-101-0011"
    },
    {
    "completionId": 5012,
    "applicationId": 30012,
    "studentId": 20012,
    "studentNo": "20210012",
    "name": "백서준",
    "dept": "수학과",
    "grade": 2,
    "phone": "010-3211-0012",
    "scheduleId": 1001,
    "scheduleName": "1회차(2025-05-10 10:00)",
    "completedAt": "2025-05-31T16:42:00",
    "attendanceRate": 92,
    "score": 89,
    "pass": "PASS",
    "mileageGranted": 10,
    "certificateNo": "CERT-101-0012"
    },
    {
    "completionId": 5013,
    "applicationId": 30013,
    "studentId": 20013,
    "studentNo": "20210013",
    "name": "윤도윤",
    "dept": "영문학과",
    "grade": 2,
    "phone": "010-3211-0013",
    "scheduleId": 1001,
    "scheduleName": "1회차(2025-05-10 10:00)",
    "completedAt": "2025-05-31T16:44:00",
    "attendanceRate": 89,
    "score": 85,
    "pass": "PASS",
    "mileageGranted": 10,
    "certificateNo": "CERT-101-0013"
    },
    {
    "completionId": 5014,
    "applicationId": 30014,
    "studentId": 20014,
    "studentNo": "20210014",
    "name": "임채린",
    "dept": "바이오공학과",
    "grade": 3,
    "phone": "010-3211-0014",
    "scheduleId": 1001,
    "scheduleName": "1회차(2025-05-10 10:00)",
    "completedAt": "2025-05-31T16:46:00",
    "attendanceRate": 94,
    "score": 91,
    "pass": "PASS",
    "mileageGranted": 10,
    "certificateNo": "CERT-101-0014"
    },
    {
    "completionId": 5015,
    "applicationId": 30015,
    "studentId": 20015,
    "studentNo": "20210015",
    "name": "허진우",
    "dept": "물리학과",
    "grade": 4,
    "phone": "010-3211-0015",
    "scheduleId": 1001,
    "scheduleName": "1회차(2025-05-10 10:00)",
    "completedAt": "2025-05-31T16:48:00",
    "attendanceRate": 83,
    "score": 79,
    "pass": "PASS",
    "mileageGranted": 10,
    "certificateNo": "CERT-101-0015"
    },
    {
    "completionId": 5016,
    "applicationId": 30016,
    "studentId": 20016,
    "studentNo": "20210016",
    "name": "장서아",
    "dept": "미디어커뮤니케이션학과",
    "grade": 1,
    "phone": "010-3211-0016",
    "scheduleId": 1001,
    "scheduleName": "1회차(2025-05-10 10:00)",
    "completedAt": "2025-05-31T16:50:00",
    "attendanceRate": 90,
    "score": 87,
    "pass": "PASS",
    "mileageGranted": 10,
    "certificateNo": "CERT-101-0016"
    },
    {
    "completionId": 5017,
    "applicationId": 30017,
    "studentId": 20017,
    "studentNo": "20210017",
    "name": "정이안",
    "dept": "행정학과",
    "grade": 2,
    "phone": "010-3211-0017",
    "scheduleId": 1001,
    "scheduleName": "1회차(2025-05-10 10:00)",
    "completedAt": "2025-05-31T16:52:00",
    "attendanceRate": 95,
    "score": 92,
    "pass": "PASS",
    "mileageGranted": 10,
    "certificateNo": "CERT-101-0017"
    },
    {
    "completionId": 5018,
    "applicationId": 30018,
    "studentId": 20018,
    "studentNo": "20210018",
    "name": "권시윤",
    "dept": "식품영양학과",
    "grade": 3,
    "phone": "010-3211-0018",
    "scheduleId": 1001,
    "scheduleName": "1회차(2025-05-10 10:00)",
    "completedAt": "2025-05-31T16:54:00",
    "attendanceRate": 87,
    "score": 83,
    "pass": "PASS",
    "mileageGranted": 10,
    "certificateNo": "CERT-101-0018"
    },
    {
    "completionId": 5019,
    "applicationId": 30019,
    "studentId": 20019,
    "studentNo": "20210019",
    "name": "노지안",
    "dept": "건축학과",
    "grade": 2,
    "phone": "010-3211-0019",
    "scheduleId": 1001,
    "scheduleName": "1회차(2025-05-10 10:00)",
    "completedAt": "2025-05-31T16:56:00",
    "attendanceRate": 98,
    "score": 96,
    "pass": "PASS",
    "mileageGranted": 10,
    "certificateNo": "CERT-101-0019"
    },
    {
    "completionId": 5020,
    "applicationId": 30020,
    "studentId": 20020,
    "studentNo": "20210020",
    "name": "남시후",
    "dept": "화학공학과",
    "grade": 3,
    "phone": "010-3211-0020",
    "scheduleId": 1001,
    "scheduleName": "1회차(2025-05-10 10:00)",
    "completedAt": "2025-05-31T16:58:00",
    "attendanceRate": 84,
    "score": 80,
    "pass": "PASS",
    "mileageGranted": 10,
    "certificateNo": "CERT-101-0020"
    },
    {
    "completionId": 5021,
    "applicationId": 30021,
    "studentId": 20021,
    "studentNo": "20210021",
    "name": "신유담",
    "dept": "교육학과",
    "grade": 4,
    "phone": "010-3211-0021",
    "scheduleId": 1001,
    "scheduleName": "1회차(2025-05-10 10:00)",
    "completedAt": "2025-05-31T17:00:00",
    "attendanceRate": 92,
    "score": 89,
    "pass": "PASS",
    "mileageGranted": 10,
    "certificateNo": "CERT-101-0021"
    },
    {
    "completionId": 5022,
    "applicationId": 30022,
    "studentId": 20022,
    "studentNo": "20210022",
    "name": "고이루",
    "dept": "데이터사이언스학과",
    "grade": 2,
    "phone": "010-3211-0022",
    "scheduleId": 1001,
    "scheduleName": "1회차(2025-05-10 10:00)",
    "completedAt": "2025-05-31T17:02:00",
    "attendanceRate": 90,
    "score": 88,
    "pass": "PASS",
    "mileageGranted": 10,
    "certificateNo": "CERT-101-0022"
    },
    {
    "completionId": 5023,
    "applicationId": 30023,
    "studentId": 20023,
    "studentNo": "20210023",
    "name": "표라온",
    "dept": "AI융합학과",
    "grade": 1,
    "phone": "010-3211-0023",
    "scheduleId": 1001,
    "scheduleName": "1회차(2025-05-10 10:00)",
    "completedAt": "2025-05-31T17:04:00",
    "attendanceRate": 99,
    "score": 97,
    "pass": "PASS",
    "mileageGranted": 10,
    "certificateNo": "CERT-101-0023"
    }
    ],
    "totalPages": 3,
    "totalElements": 23,
    "number": 0,
    "size": 10,
    "summary": {
    "passCount": 23,
    "failCount": 0,
    "avgAttendance": 91.9,
    "avgScore": 89.7,
    "mileagePerStudent": 10
    }
    }
];

</script>
</body>
</html>
